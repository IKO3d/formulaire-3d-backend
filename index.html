<script>
  document.getElementById('tester').addEventListener('click', function () {
    const payload = {
      email: "test@iko3d.fr",
      message: "Ceci est un test de fonctionnement EmailJS via Render",
      fichier3d: "TEST_base64_simulé",
      filename: "test.stl"
    };

    fetch("https://formulaire-3d-backend.onrender.com/send-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(async res => {
      const contentType = res.headers.get("Content-Type");
      const isJson = contentType && contentType.includes("application/json");
      const data = isJson ? await res.json() : { success: false, error: "Réponse non JSON" };

      document.getElementById('etat').textContent = data.success
        ? "✅ Email envoyé avec succès"
        : "❌ Erreur EmailJS : " + (data.error || "inconnue");

      console.log("Réponse EmailJS :", data);
    })
    .catch(err => {
      document.getElementById('etat').textContent = "❌ Erreur JS : " + err.message;
      console.error("Erreur JS :", err);
    });
  });
</script>
